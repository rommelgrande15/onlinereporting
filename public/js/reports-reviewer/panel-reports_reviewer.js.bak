//Dropzone.autoDiscover = false;
$(document).ready(function () {
	var auth_id = "{{Auth::id()}}";
	var token = "{{csrf_token()}}";
	/**
	 * Apply the same filter to all DataTable instances on a particular page. The
	 * function call exactly matches that used by `fnFilter()` so regular expression
	 * and individual column sorting can be used.
	 *
	 * DataTables 1.10+ provides this ability through its new API, which is able to
	 * to control multiple tables at a time.
	 * `$('.dataTable').DataTable().search( ... )` for example will apply the same
	 * filter to all tables on the page. The new API should be used in preference
	 * to this older method if at all possible.
	 *
	 *  @name fnFilterAll
	 *  @summary Apply a common filter to all DataTables on a page
	 *  @author [Kristoffer Karlstr√∂m](http://www.kmmtiming.se/)
	 *  @deprecated
	 *
	 *  @param {string} sInput Filtering input
	 *  @param {integer} [iColumn=null] Column to apply the filter to
	 *  @param {boolean} [bRegex] Regular expression flag
	 *  @param {boolean} [bSmart] Smart filtering flag
	 *
	 *  @example
	 *    $(document).ready(function() {
	 *      var table = $(".dataTable").dataTable();
	 *       
	 *      $("#search").keyup( function () {
	 *        // Filter on the column (the index) of this element
	 *        table.fnFilterAll(this.value);
	 *      } );
	 *    });
	 */

	//.on('click', '#btn_view', function () {
	//			var dis = this;
	//			var id = $(dis).data('id');
	//			var service = $(dis).data('service');
	//			var factory = $(dis).data('fac');
	//			var date = $(dis).data('date');
	//			$('#cancel_service').text(service);
	//			$('#cancel_fac_name').text(factory);
	//			$('#cancel_ins_date').text(date);
	//			$('#cancel_ins_id').val(id);
	//$('#modalViewReport').modal('show');
	$('body')

		.on('click', '#btn_select', function () {
			var dis = this;
			var inspection_id = $(dis).data('id');
			var ref_no = $(dis).data('ref_no');
			$.ajax({
				url: '/get-client-report/' + $(this).data('id'),
				type: 'GET',
				dataType: 'json',
				success: function (response) {
					$('#refe_no').val(ref_no);
					$('#inspection_id').val(inspection_id);
					$('#company_email').val(response.clients.Company_Email);
					$('#modalSendReport').modal('show');
				},
				error: function (err) {
					console.log(err);
				}
			})
		})

	$.ajaxSetup({
		headers: {
			'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		}
	});
	$('.btn_view').click(function () {

		var table = $("#table_report_content");
		var tableString = "";
		table.empty();
		var dis = this;
		var id = $(dis).data('id');
		var ref_no = $(dis).data('ref_no');

		$.ajax({
			url: "/view-uploaded-report",
			method: "POST",
			data: {
				id: id
			},
			success: function (data) {
				if (data == "") {
					swal({
						position: 'top-end',
						type: 'error',
						title: 'No file/s found.',
						showConfirmButton: true,
						timer: 1000
					});
				} else {
					$('#ref_nu').html(ref_no);
					/*tableString += "<div class='modal-header'><button type='button' class='close' data-dismiss='modal'>&times;</button><h4 class='modal-title text-center'>Uploaded Report</h4></div><div class='modal-body'><div class='row'><div class='col-md-12'><p><label>Reference #:</label> " + ref_no + "</p><table id='reports_table' class='table table-condensed cell-border small dataTable no-footer'><thead><tr><th class='text-center'>Report File</th><th class='text-center'>Size</th><th class='text-center'>Reviewer</th><th class='text-center'>Date</th><th class='text-center'>Download</th></tr></thead><tbody>";*/
					$.each(data, function (a, b) {
						function humanFileSize(size) {
							var i = size == 0 ? 0 : Math.floor( Math.log(size) / Math.log(1024) );
							return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'KB', 'MB', 'GB', 'TB'][i];
						};
						tableString += "<tr>" +
							"<td>" + b.report_file + "</td>" +
							"<td>" + humanFileSize(b.report_file_size) + "</td>" +
							"<td>" + b.name + "</td>" +
							"<td>" + b.created_at + "</td>" +
							"<td class='text-center'><a href='/download-report-file/" + b.inspection_id + "/" + b.report_file + "' class='btn btn-block btn-xs btn-primary' download><i class='fa fa-download'></i></a></td></tr>";
					});
					tableString += "</tbody></table></div></div></div>";
					table.append(tableString);
					$('#modalViewReport').modal("show");
				}
			},
		});

	});


});
