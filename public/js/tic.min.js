var templateTitle=(localStorage.getItem('tic-editing')==='true')?localStorage.getItem('tic-name'):'New Template';var token=document.getElementsByName('csrf-token')[0].content;function builderHeight(){$('#tic-builder').css('height',$(window).height()-133)}
function copyTemplate(){if(localStorage.getItem('tic-editing')==='true'){if(confirm('Changes on your current editing template will be overwritten. Proceed?')){loadTemplate()}}else{loadTemplate()}}
function deleteTemplate(){if(projectId){if(confirm('Are you sure you want to delete this template?')){var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){removeTemplateList(projectId)}};xhttp.open('GET','/template/'+projectId+'/delete',!0);xhttp.setRequestHeader('X-CSRF-TOKEN',token);xhttp.send()}}else{alert('Please select a project first!')}}
function loadTemplate(){if(projectId){editor.StorageManager.get('remote').set({urlLoad:'/template/'+projectId,id:null}).load(['components','styles'],res=>{templateTitle='Copy of '+res.name
    document.querySelector('.document-title-cont').innerHTML=templateTitle;editor.setComponents(JSON.parse(res.components));editor.setStyle(JSON.parse(res.styles))});localStorage.setItem('tic-editing',!0);closeMenu()}else{alert('Please select a project first!')}}
function newTemplate(){editor.DomComponents.clear();editor.setComponents(initComponents);templateTitle='New Template';document.querySelector('.document-title-cont').innerHTML=templateTitle;localStorage.setItem('tic-editing',!0);closeMenu()}
function closeMenu(){$('.document-menu-cont').fadeOut('slow',function(){$('.document-menu-cont').css('display','none')});if(document.querySelector('.project.selected'))
    document.querySelector('.project.selected').classList.remove('selected')}
function openMenu(){document.querySelector('.document-menu-cont').style.display="flex"}
function pageCounter(){var currentPageHeight=document.getElementsByClassName('gjs-frame')[0].contentWindow.document.getElementById('wrapper').scrollHeight;var perPageHeight=1056;var pageCtr=document.getElementById('page-counter');pageCtr.innerHTML='# of page: '+Math.ceil(currentPageHeight/perPageHeight)}
function addTemplateList(id,name,created){var container=$('.project-container-list');var prependChild=$(`<div class="project" id="${id}"><div class="project-title">${name}</div><small>created ${created}</small></div>`);container.prepend(prependChild);openMenu()}
function removeTemplateList(id){$('#'+id).remove()}
var initComponents=[{name:'Header',type:'table',classes:['header'],style:{'width':'100%','margin-bottom':'10px','padding':'5px'},droppable:0,draggable:0,removable:0,copyable:0,traits:[{type: 'checkbox',label: 'Render as Image',name: 'render-as-img'}],components:[{type:'tbody',components:[{type:'row',style:{'height':'40px'},components:{tagName:'th',type:'cell',attributes:{colspan:'100'},content:'Header (This cell will not be rendered)',droppable:0,draggable:0,removable:0,copyable:0,},droppable:0,},{type:'row',style:{'height':'40px'},components:[{tagName:'td',type:'cell',style:{'height':'40px','min-width':'40px'},removable:0,copyable:0,resizable:{tl:0,tc:0,tr:0,bl:0,bc:0,br:0},traits:[{type:'number',label:'Colspan',name:'colspan'},{type:'number',label:'Rowspan',name:'rowspan'}]},{tagName:'td',type:'cell',style:{'height':'40px','min-width':'40px'},resizable:{tl:0,tc:0,tr:0,bl:0,bc:0,br:0},traits:[{type:'number',label:'Colspan',name:'colspan'},{type:'number',label:'Rowspan',name:'rowspan'}]}],}],}]},{name:'Footer',type:'table',classes:['footer'],style:{'width':'100%','margin-bottom':'10px','padding':'5px'},droppable:0,draggable:0,removable:0,copyable:0,traits:[{type: 'checkbox',label: 'Render as Image',name: 'render-as-img'}],components:[{type:'tbody',components:[{type:'row',style:{'height':'40px'},components:{tagName:'th',type:'cell',attributes:{colspan:'100'},content:'Footer (This cell will not be rendered)',droppable:0,draggable:0,removable:0,copyable:0,},droppable:0,},{type:'row',style:{'height':'40px'},components:[{tagName:'td',type:'cell',style:{'height':'40px','min-width':'40px'},removable:0,copyable:0,resizable:{tl:0,tc:0,tr:0,bl:0,bc:0,br:0},traits:[{type:'number',label:'Colspan',name:'colspan'},{type:'number',label:'Rowspan',name:'rowspan'}]},{tagName:'td',type:'cell',style:{'height':'40px','min-width':'40px'},resizable:{tl:0,tc:0,tr:0,bl:0,bc:0,br:0},traits:[{type:'number',label:'Colspan',name:'colspan'},{type:'number',label:'Rowspan',name:'rowspan'}]}],}],}]}];var sectors=[{name:'General',open:0,buildProps:['font-family','font-size','font-weight','letter-spacing','color','background-color','line-height','width','height','border','text-align'],properties:[{property:'text-align',list:[{value:'left',className:'fa fa-align-left'},{value:'center',className:'fa fa-align-center'},{value:'right',className:'fa fa-align-right'},{value:'justify',className:'fa fa-align-justify'}],}]}];var editor=grapesjs.init({container:'#tic-builder',autorender:0,avoidInlineStyle:1,height:'100%',showDevices:0,plugins:['tic-plugin'],protectedCss:'div[data-gjs-type=default]::before{content:attr(label);display:block;color:#4169e1;font-weight:bold}div[tic-input=cb-options]::before{content:attr(label);color:#4169e1;font-weight:bold}',storageManager:{id:'tic-',type:'local',autosave:0,autoload:1,stepsBeforeSave:1,contentTypeJson:1,storeComponents:1,storeStyles:1,storeHtml:1,storeCss:1,},assetManager:{noAssets:'No assets available!',upload:'/template/assets',uploadName:'file',headers:{'X-CSRF-TOKEN':token}},styleManager:{clearProperties:1,sectors:sectors,},components:initComponents,});var panelManager=editor.Panels;panelManager.addButton('options',[{id:'undo',className:'fa fa-undo icon-undo',command:function(e){return e.runCommand('core:undo')},attributes:{title:'Undo'}},{id:'redo',className:'fa fa-repeat icon-redo',command:function(e){return e.runCommand('core:redo')},attributes:{title:'Redo'}},{id:'save-database',className:'fa fa-floppy-o icon-blank',command:'save-db',attributes:{title:'Save to database'}}]);panelManager.getButton("views","open-blocks").set('active',1);panelManager.removeButton("views","open-layers");panelManager.removeButton("options","export-template");panelManager.removeButton("options","preview");panelManager.addPanel({id:'commanders',visible:1,buttons:[{id:'open-menu',className:'fa fa-bars icon-blank',command:function(e){openMenu()},attributes:{title:'Open Menu'}}],});editor.on('canvas:drop',function(e,m){if(m.attributes.name=='Table'){m.set('draggable',0);m.set('toolbar',[{attributes:{class:'fa fa-arrow-up'},command:'select-parent'},{attributes:{class:'fa fa-clone'},command:'tlb-clone'},{attributes:{class:'fa fa-trash-o'},command:'tlb-delete'}])}});editor.on('component:selected',function(e){if(e.attributes.attributes.id=='wrapper')
    panelManager.getButton("views","open-blocks").set('active',1);else panelManager.getButton("views","open-sm").set('active',1)});editor.Commands.add('save-db',{run:function(editor,sender){var name=prompt('Enter template name')
    if(name!=null&&name!=''){editor.StorageManager.get('remote').set({urlStore:'/template',headers:{'X-CSRF-TOKEN':token},}).store({name:name,html:editor.getHtml(),css:editor.getCss(),styles:editor.getStyle(),components:editor.getComponents()},(data)=>{if(data!=null){addTemplateList(data.id,data.name,data.created)
        editor.getModel().set('changesCount',0);document.querySelector('.document-title-cont').innerHTML='New Template';editor.DomComponents.clear();editor.setComponents(initComponents);localStorage.setItem('tic-editing',!1)}},(err)=>{alert('Error occured while saving the template')})}
    sender.set('active',0)},});editor.on('storage:store',function(){localStorage.setItem('tic-name',templateTitle)});editor.on('storage:load',function(){document.querySelector('.document-title-cont').innerHTML=templateTitle});editor.on('load',function(){var wrapper=editor.DomComponents.getWrapper();wrapper.set('stylable',[]);var $=grapesjs.$;var openTmBtn=panelManager.getButton('views','open-tm');openTmBtn&&openTmBtn.set('active',1);var openSm=panelManager.getButton('views','open-sm');openSm&&openSm.set('active',1);var traitsSector=$('<div class="gjs-sm-sector no-select">'+'<div class="gjs-sm-title"><span class="icon-settings fa fa-cog"></span> Settings</div>'+'<div class="gjs-sm-properties"></div></div>');var traitsProps=traitsSector.find('.gjs-sm-properties');traitsProps.append($('.gjs-trt-traits'));$('.gjs-sm-sectors').before(traitsSector);traitsSector.find('.gjs-sm-title').on('click',function(){var traitStyle=traitsProps.get(0).style;var hidden=traitStyle.display=='none';if(hidden){traitStyle.display='block'}else{traitStyle.display='none'}});var titleCont=document.querySelector('.document-title-cont');var menuCont=document.querySelector('.document-menu-cont');var titlePanel=document.querySelector('.gjs-pn-buttons');var menuPanel=document.querySelector('#tic-builder');titlePanel.removeChild(document.querySelector('.gjs-pn-btn'));titlePanel.appendChild(titleCont);menuPanel.appendChild(menuCont);panelManager.removeButton("views","open-tm");var openBlocksBtn=editor.Panels.getButton('views','open-blocks');openBlocksBtn&&openBlocksBtn.set('active',1);pageCounter()});editor.on('run:fullscreen',()=>{fullscreen=!0});editor.on('stop:fullscreen',()=>{fullscreen=!1});editor.on('change:changesCount',(editorModel,changes)=>{if(changes)
    pageCounter()});editor.DomComponents.getWrapper().set({badgable:0, selectable:0,hoverable:0});editor.render()